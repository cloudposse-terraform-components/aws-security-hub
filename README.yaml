name: "aws-security-hub"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-security-hub"
# Short description of this project
description: |-
  This component is responsible for configuring Security Hub within an AWS Organization.

  Amazon Security Hub enables users to centrally manage and monitor the security and compliance of their AWS accounts and
  resources. It aggregates, organizes, and prioritizes security findings from various AWS services, third-party tools, and
  integrated partner solutions.

  ## Key Features

  - **Centralized Security Management**: Provides a centralized dashboard where users can view and manage security
    findings from multiple AWS accounts and regions, allowing for a unified view of the security posture across the
    entire AWS environment.

  - **Automated Security Checks**: Automatically performs continuous security checks on AWS resources, configurations,
    and security best practices using industry standards and compliance frameworks such as AWS CIS Foundations Benchmark.

  - **Product Subscriptions**: Integrates with AWS security services (GuardDuty, Inspector, Macie, Config, Access
    Analyzer, Firewall Manager) to automatically receive and aggregate findings in a single dashboard.

  - **Security Standards and Compliance**: Provides compliance checks against industry standards and regulatory
    frameworks such as PCI DSS, HIPAA, NIST 800-53, and GDPR, with guidance on remediation actions.

  - **Prioritized Security Findings**: Analyzes and prioritizes security findings based on severity, enabling users to
    focus on the most critical issues with efficient threat response and remediation.

  - **Custom Insights and Event Aggregation**: Supports custom insights and rules to focus on specific security criteria,
    with event aggregation and correlation capabilities to identify related findings and attack patterns.

  - **Alert Notifications and Automation**: Supports alert notifications through Amazon SNS and facilitates automation
    through integration with AWS Lambda for automated remediation actions.

  - **GovCloud Support**: All product subscription ARNs use partition-aware format, automatically supporting both
    Commercial AWS and GovCloud partitions.

  ## Component Features

  - **Delegated Administrator Model**: Uses AWS Organizations delegated administrator pattern for centralized management
  - **Multi-Region Deployment**: Supports deployment across all AWS regions with finding aggregation
  - **Product Subscriptions**: Automatically creates subscriptions for AWS security service integrations
  - **SNS Notifications**: Optional SNS topic creation for security finding alerts
  - **Compliance Standards**: Configurable security standards (CIS, PCI DSS, AWS Foundational Security Best Practices)

usage: |-
  **Stack Level**: Regional

  ## Deployment Overview

  This component is complex in that it must be deployed multiple times with different variables set to configure the AWS
  Organization successfully.

  It is further complicated by the fact that you must deploy each of the component instances described below to every
  region that existed before March 2019 and to any regions that have been opted-in as described in the
  [AWS Documentation](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-regions).

  In the examples below, we assume that the AWS Organization Management account is `root` and the AWS Organization
  Delegated Administrator account is `security`, both in the `core` tenant.

  ### Deploy to Delegated Administrator Account

  First, the component is deployed to the
  [Delegated Administrator](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_organizations.html) account in each
  region to configure the Security Hub instance to which each account will send its findings.

  ```yaml
  # core-ue1-security
  components:
    terraform:
      security-hub/delegated-administrator/ue1:
        metadata:
          component: security-hub
        vars:
          enabled: true
          delegated_administrator_account_name: core-security
          environment: ue1
          region: us-east-1
          # Product subscriptions for AWS security service integrations
          product_subscriptions:
            guardduty: true        # Enable GuardDuty findings
            inspector: true        # Enable Inspector findings
            macie: true            # Enable Macie findings
            config: true           # Enable Config findings
            access_analyzer: true  # Enable Access Analyzer findings
            firewall_manager: false # Disabled by default
  ```

  ```bash
  atmos terraform apply security-hub/delegated-administrator/ue1 -s core-ue1-security
  atmos terraform apply security-hub/delegated-administrator/ue2 -s core-ue2-security
  atmos terraform apply security-hub/delegated-administrator/uw1 -s core-uw1-security
  # ... other regions
  ```

  ### Deploy to Organization Management (root) Account

  Next, the component is deployed to the AWS Organization Management (a/k/a `root`) Account in order to set the AWS
  Organization Designated Administrator account.

  Note that `SuperAdmin` permissions must be used as we are deploying to the AWS Organization Management account. Since we
  are using the `SuperAdmin` user, it will already have access to the state bucket, so we set the `role_arn` of the
  backend config to null and set `var.privileged` to `true`.

  ```yaml
  # core-ue1-root
  components:
    terraform:
      security-hub/root/ue1:
        metadata:
          component: security-hub
        backend:
          s3:
            role_arn: null
        vars:
          enabled: true
          delegated_administrator_account_name: core-security
          environment: ue1
          region: us-east-1
          privileged: true
  ```

  ```bash
  atmos terraform apply security-hub/root/ue1 -s core-ue1-root
  atmos terraform apply security-hub/root/ue2 -s core-ue2-root
  atmos terraform apply security-hub/root/uw1 -s core-uw1-root
  # ... other regions
  ```

  ### Deploy Organization Settings in Delegated Administrator Account

  Finally, the component is deployed to the Delegated Administrator Account again in order to create the organization-wide
  Security Hub configuration for the AWS Organization, but with `var.admin_delegated` set to `true` this time to indicate
  that the delegation from the Organization Management account has already been performed.

  ```yaml
  # core-ue1-security
  components:
    terraform:
      security-hub/org-settings/ue1:
        metadata:
          component: security-hub
        vars:
          enabled: true
          delegated_administrator_account_name: core-security
          environment: ue1
          region: us-east-1
          admin_delegated: true
  ```

  ```bash
  atmos terraform apply security-hub/org-settings/ue1 -s core-ue1-security
  atmos terraform apply security-hub/org-settings/ue2 -s core-ue2-security
  atmos terraform apply security-hub/org-settings/uw1 -s core-uw1-security
  # ... other regions
  ```

  ## Product Subscriptions

  Product subscriptions enable Security Hub to receive and aggregate findings from AWS security services. The component
  supports automatic integration with:

  | Product          | Default | Description                          |
  |------------------|---------|--------------------------------------|
  | GuardDuty        | `true`  | Threat detection findings            |
  | Inspector        | `true`  | Vulnerability scanning findings      |
  | Macie            | `true`  | Sensitive data discovery findings    |
  | Config           | `true`  | Configuration compliance findings    |
  | Access Analyzer  | `true`  | External access findings             |
  | Firewall Manager | `false` | Firewall policy compliance findings  |

  Product subscriptions are only created during Step 1 (delegated administrator deployment) and use partition-aware ARN
  format for GovCloud compatibility.

  ### Verification

  After deployment, verify product subscriptions:

  ```bash
  # Via Terraform output
  atmos terraform output security-hub/delegated-administrator/ue1 -s core-ue1-security

  # Via AWS CLI
  aws securityhub list-enabled-products-for-import --region us-east-1
  ```

  <!-- prettier-ignore-start -->
  <!-- prettier-ignore-end -->
references:
  - name: AWS Security Hub Documentation
    description: Official AWS documentation for Security Hub
    url: https://docs.aws.amazon.com/securityhub/
  - name: Security Hub Organization Administration
    description: Managing Security Hub across AWS Organizations
    url: https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-accounts-orgs.html
  - name: Security Hub Product Integrations
    description: Integrating AWS services with Security Hub via product subscriptions
    url: https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-findings-providers.html
  - name: Security Hub Standards
    description: Security standards and compliance frameworks in Security Hub
    url: https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards.html
  - name: Security Hub Finding Aggregation
    description: Cross-region finding aggregation configuration
    url: https://docs.aws.amazon.com/securityhub/latest/userguide/finding-aggregation.html
  - name: CloudPosse Security Hub Terraform Module
    description: The underlying Terraform module used by this component
    url: https://github.com/cloudposse/terraform-aws-security-hub
  - name: Cloud Posse's upstream component
    description: Original component in terraform-aws-components
    url: https://github.com/cloudposse/terraform-aws-components/tree/main/modules/security-hub
tags:
  - component/security-hub
  - layer/security-and-compliance
  - provider/aws
# Categories of this project
categories:
  - component/security-hub
  - layer/security-and-compliance
  - provider/aws
# License of this project
license: "APACHE2"
# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-security-hub.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-security-hub/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com
related:
  - name: "Cloud Posse Terraform Modules"
    description: Our collection of reusable Terraform modules used by our reference architectures.
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"
  - name: "terraform-aws-security-hub"
    description: "Terraform module to provision AWS Security Hub"
    url: "https://github.com/cloudposse/terraform-aws-security-hub"
  - name: "aws-guardduty"
    description: "Component for AWS GuardDuty threat detection"
    url: "https://github.com/cloudposse-terraform-components/aws-guardduty"
  - name: "aws-config"
    description: "Component for AWS Config compliance management"
    url: "https://github.com/cloudposse-terraform-components/aws-config"
  - name: "aws-inspector2"
    description: "Component for AWS Inspector vulnerability scanning"
    url: "https://github.com/cloudposse-terraform-components/aws-inspector2"
contributors: [] # If included generates contribs
